<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/html">

<!-- mwDebuggerUnit for the Kaltura player -->
<!-- Version 1.0 -->
<!-- Copyright(c) 2017 Alex Milkis <alex.milkis@kaltura.com> -->
<!-- MIT Licensed. http://www.opensource.org/licenses/mit-license.php -->
<!-- http://corp.kaltura.com -->


<head>
    <title>mwDebugger Unit v1.0</title>
    <!--Scripts sections-->
    <script src="http://code.jquery.com/jquery-2.2.4.min.js"></script>
    <script src="http://jsoverson.github.io/jquery.pulse.js/jquery.pulse.js"></script>
    <script src="/mwEmbed/mwEmbedLoader.php/p/1955031/sp/195503100/embedIframeJs/uiconf_id/37558971/partner_id/1955031"></script>
    <link rel="stylesheet" href="css/mainStyles.css">
    <link rel='shortcut icon' type='image/x-icon' href='favicon.ico'/>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
</head>

<body>

<div id="errorBar" style="padding-left: 10px">
    <h4></h4><button class="btn btn-default btn-xs" id="okError" style="float: left; margin-top: 3px; margin-left: 10px;">OK</button>
</div>
<div class="navbarTop">
    <div style="float: left">
    <a class="dropbtn">Home</a>
    <div class="dropdown">
    <button class="dropbtn">Player Functions</button>
        <div class="dropdown-content">
        <a onclick="embed();cleanPreviousErrors();">Reload player</a>
        <a href="#" id="getActiveSource" onclick="getActiveSource()">Download active flavor</a>
        <a onclick="getActiveBitrate()">Get Current Bitrate (Chrome/Firefox Only)</a>
        <a onclick="getYouboraAnalytics()">Track Youbora Analytics</a>
        <a onclick="getGoogleAnalytics()">Track Google Analytics</a>
        </div>
    </div>
    <div class="dropdown">
        <button class="dropbtn">Video Debugging Tools</button>
        <div class="dropdown-content">
            <a href="#">Get video aspect ratio</a>
            <a href="https://shaka-player-demo.appspot.com/demo/" target="_blank">Standalone Dash Shaka player</a>
            <a href="https://video-dev.github.io/hls.js/demo/" target="_blank">Standalone HLS.JS player</a>
            <a href="http://players.akamai.com/hds/" target="_blank">Standalone Akamai HDS player</a>
            <a href="http://players.akamai.com/hls/" target="_blank">Standalone Akamai HLS player</a>
        </div>
    </div>
        <div class="dropdown">
            <button class="dropbtn">Ad Debugging Tools</button>
            <div class="dropdown-content">
                <a href="#" id="testOnVast" onclick="goToVast()">Test on Google VAST inspector</a>
                <a href="https://i.loopme.me/html/vpaid/test-page.html" target="_blank">VPAID ad tester</a>
                <a href="http://tagvalidator.videohub.tv/?adtag=&playerType=jwPlayer&playerSize=640x360&adtagType=&adChoicesOverlay=off" target="_blank">VideoHub ad tester</a>
                <a href="https://video-dev.github.io/hls.js/demo/" target="_blank">Standalone HLS.JS player</a>
                <a href="http://www.zedo.com/vastvalidator/" target="_blank">Zedo ad tester</a>
            </div>
        </div>
        <div class="dropdown">
        <button class="dropbtn">Commands</button>
        <div class="dropdown-content">
            <a href="#" id="cleanMedia">Unload video asset</a>
            <a href="#" id="removeThumb">Remove Thumbnail</a>
            <a href="#" id="removePlay">Remove play button</a>
            <a href="#" id="hideControls">Hide controls bar</a>
        </div>
    </div>
    </div>
    <div style="float: right; height: 25px; width: 600px; padding-right: 20px; padding-top: 2px">
        <form class="form-inline pull-right">
            <div class="form-group">
                <input type="search" class="form-control input-sm" style="height: 19px !important;" id="searchInput" placeholder="Search VPaaS">
            </div>
            <button type="submit" class="btn btn-default btn-xs" style="height: 19px !important;" onclick="vpaasSearch()">Search</button>
        </form>
    </div>
    </div>

<!--Player main div-->
<div id="topHeaderDiv">
    <div class="containerLeft">
        <h2>mwDebugger Unit v1.0</h2>
        <h6 id="uiconfText"></h6>
        <h6 id="entryIdText"></h6>
        <h6 id="loadTime"></h6>
        <h6 id="appVersion"></h6>
    </div>

<div class="containerRight">
    <!--QRCode Generator - Google Charts-->
    <p><img src="" id="generateMe" /></p>
    <script type="text/javascript">
        let ele = document.getElementById("generateMe");
        ele.src = "https://chart.googleapis.com/chart?cht=qr&chs=130x130&chl=" + document.location.href;
    </script>
    </div>
</div>
    <br>
    <!--The main section Player + Stats-->
    <div style="width:1125px; height: 335px; margin: auto;">
    <!--Main player DIV-->
    <div id="kPlayer_ifp" itemprop="video" itemscope></div>
    <!--Small analytics log DIV-->
    <pre id="appendStats"></pre></div>
    <!--Control panel & buttons DIV-->
    <div style="clear: both;"></div>
    <div id="mainControlDiv">
        <button type="button" onclick="changeEmbed()" class="btn btn-primary btn-xs" style="float: left;">Change Embed code</button>
        <button type="button" class="btn btn-primary btn-xs" onclick=doPlay()>Force Play</button>
        <button type="button" class="btn btn-primary btn-xs" onclick=doStop()>Force Stop</button>
        <button type="button" id="getSource" class="btn btn-primary btn-xs">get Sources</button>
        <button type="button" id="getCaptions" class="btn btn-primary btn-xs">get Captions</button>
        <button type="button" id="getTiny" class="btn btn-primary btn-xs" onclick="tiny()">get TinyUrl</button>
        <button type="button" onclick="embed();cleanPreviousErrors();" class="btn btn-primary btn-xs" style="float: left;">Reload player</button>

        <br><h7 style="font-family: Arial; font-size: smaller;">Entry ID changer:</h7>
        <form style="margin-top: 5px" id="formEntry" onsubmit="return false;">
            <input class="inputBox" type="text" id="adInput" placeholder="Input entry id"/>
            <input class="btn btn-primary btn-xs" onclick="setEntry();" type="submit"/>
        </form>
        <h7 style="font-family: Arial; font-size: smaller;">KS Changer:</h7>
        <form style="margin-top: 5px" id="formKs" onsubmit="return false;">
            <input class="inputBox" style="width: 300px;" type="text" id="ksInput" placeholder="Input valid KS"/>
            <input class="btn btn-primary btn-xs" type="submit" onclick="setKS();"/>
        </form>
        <h7 style="font-family: Arial; font-size: smaller; margin-bottom: 5px;">DoubleClick ad tag:</h7><br>
        <input class="inputBox" style="width: 300px;" type="text" oninput="showReloadWarning()" id="adTagId" />
        <button type="button" class="btn btn-primary btn-xs" style="margin: 0;" onclick=embed()>Apply new adtag
    </button>
        <select id="adSlotSelector" style="width: 200px !important; display: inline;" class="form-control bg-primary" name="adPresetSelector" size="1" onchange="appendSlot(event)">
            <option selected disabled>Select sample ad tag</option>
        </select>

        <div class="alert alert-warning alert-dismissible" id="updateNotification" role="alert" style="width: 450px; margin-top: 5px;">
            <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            Don't forget to reload the player after making any changes.
        </div>
        <div id="customEmbedParams">
            <p>Please enter valid embed settings:</p>
            <form onsubmit="return false;">
                <input id="embedPathSelector" type="checkbox" checked="true" style="width: 16px; height: 16px;"/><samp style="font-family: Arial; font-size: small; color: black;">Use local mwEmbed library. (For localhost environment only)</samp><br>
                <input id="partnerId" class="inputBox" type="text" placeholder="Partner Id"/><br>
                <input id="uiconfId" class="inputBox" placeholder="Player Id"/><br>
                <input id="entryId" class="inputBox" type="text" placeholder="Entry Id"/>
                <input onclick="buildPath()" class="btn btn-primary btn-xs" style="width: 100px;" type="submit"/>
            </form>
            <textarea class="uivarsOverride" placeholder="Add valid flashvars:"></textarea>
        </div>
    </div><br>
    <!--JSON Config DIV-->
<div style="width:1125px; height: 410px; margin: 0 auto;">
    <p style="font-size: small; font-family: Arial;">Player's JSON config:</p>
    <pre id="appendJSON"></pre>
    <div id="analyticsLog" style="float: right; box-sizing: border-box;">
</div>
    <script>
        var runtimeFields = $("#appendJSON,#loadTime,#entryIdText,#uiconfText,#appVersion");
        //kBinds and other functions
        kWidget.addReadyCallback(function (playerId) {
            let kdp = document.getElementById(playerId);
            kdp.kBind('playerReady', function () {
                let entryIdField = $("#entryIdText");
                let uiconfIdField = $("#uiconfText");
                let loadTimeField = $("#loadTime");
                let appVersionField = $("#appVersion");
                let loadedTime = window.performance.timing.domContentLoadedEventEnd - window.performance.timing.navigationStart;
                entryIdField.append(kdp.evaluate("Entry id: " + "{mediaProxy.entry.id}"));
                uiconfIdField.append(kdp.evaluate("Player id: " + "{configProxy.kw.uiConfId}"));
                loadTimeField.prepend("Page loaded in " + loadedTime + " milliseconds");
                appVersionField.append("User agent: " + clientInformation.appVersion);
            });
            kdp.kBind('mediaReady', function () {
                $("#analyticsLog").append("Media Ready\n<br>").addClass('greenText');
            });
            kdp.kBind('adEnd', function () {
                $("#analyticsLog").append("Ad Ended\n<br>").addClass('greenText');
            });
            kdp.kBind('postSequenceStart', function () {
                $("#analyticsLog").append("Post Sequence Started\n<br>").addClass('greenText');
            });
            kdp.kBind('firstPlay', function () {
                $("#analyticsLog").append("First Play\n<br>").addClass('greenText');
            });
            kdp.kBind('doPause', function () {
                $("#analyticsLog").append("Player Paused\n<br>").addClass("greenText");
            });
            kdp.kBind('doPlay', function () {
                $("#analyticsLog").append("Player Playing\n<br>").addClass("greenText");
            });
            kdp.kBind('playerError', function (errorEvent) {
                if($("#errorBar h4").text().length === 0) {
                $("#errorBar").slideDown(300);
                $("#errorBar h4").append("An error has been logged on the player - " + errorEvent.message);
            }});
            //OK button handler
            $('#okError').click(function () {
                $('#errorBar').slideUp(300);
            });
            kdp.kBind('entryReady', function () {
                $("#analyticsLog").append("Bumper Started\n<br>").addClass("greenText");
                cleanPreviousErrors();
            });
            kdp.kBind('postSequenceStart', function () {
                $("#analyticsLog").append("Playing Post Sequence.\n<br>").addClass("greenText");
            })
        });

        //The mainBrain
        function setEntry() {
            kWidget.addReadyCallback(function (playerId) {
                let kdp = document.getElementById(playerId);
                let input = document.getElementById("adInput").value;
                kdp.sendNotification("changeMedia", {
                    "entryId": input
                });
            })
        }
        let cleanMedia = $("#cleanMedia");
        cleanMedia.click(function () {
            kWidget.addReadyCallback(function (playerId) {
                let kdp = document.getElementById(playerId);
                kdp.sendNotification("cleanMedia");
            })
        });
        function vpaasSearch() {
            let searchTerm = $('#searchInput').val();
            window.open("https://vpaas.kaltura.com/search/#stq=" + searchTerm + "&stp=1")
        }
        function setKS() {
            runtimeFields.empty();
            kWidget.addReadyCallback(function (playerId) {
                let kdp = document.getElementById(playerId);
                let input = document.getElementById("ksInput").value;
                kdp.setKDPAttribute('servicesProxy.kalturaClient', 'ks', input);
                cleanPreviousErrors();
            });
            cleanPreviousErrors();
        }
        function cleanPreviousErrors(){
            if($("#errorBar h4").text().length > 2) {
                $("#errorBar h4").text('');
                $('#errorBar').slideUp(300);
            }
        }
        function doPlay() {
            kWidget.addReadyCallback(function (playerId) {
                let kdp = document.getElementById(playerId);
                kdp.sendNotification("doPlay");
            })
        }

        function doStop() {
            kWidget.addReadyCallback(function (playerId) {
                let kdp = document.getElementById(playerId);
                kdp.sendNotification("doStop");
            })
        }

        function callAd() {
            kWidget.addReadyCallback(function (playerId) {
                let adInput = $('#adTagId').val();
                window.open(adInput);
                return false;
            })
        }

        function changeEmbed() {
            if ($('#customEmbedParams').css("display") == "none") {
                $("#customEmbedParams").slideDown(500);
            }
            else {
                $("#customEmbedParams").slideUp(500);
            }
        }
        kWidget.addReadyCallback(function (playerId) {
            let kdp = document.getElementById(playerId);
            kdp.kBind('playerReady', function () {
                let playerFrame = document.kPlayer_ifp_ifp;
                $("#appendJSON").append(JSON.stringify(playerFrame.kalturaIframePackageData.playerConfig.plugins, null, 2));
                $(".mw-debug-info").append(playerFrame.kalturaIframePackageData.playerConfig.plugins.debugInfo);
                return false;
            })
        });

        // Top menu buttons and logic
        let removeThumb = $("#removeThumb");
        removeThumb.click(function () {
            const playerContent = $("#kPlayer_ifp_ifp").contents()[0];
            const playerThumb = $(playerContent).find("#kPlayer_ifp");
            if ($(playerThumb).css("visibility") == 'visible') {
                document.getElementById('removeThumb').textContent = "Show thumbnail";
                $(playerThumb).css("visibility", "hidden");
            }
            else {
                $(playerThumb).css("visibility", "visible");
                document.getElementById('removeThumb').textContent = "Hide thumbnail";
            }
        });
        let removePlay = $("#removePlay");
        removePlay.click(function () {
            const playerContent = $("#kPlayer_ifp_ifp").contents()[0];
            const playButton = $(playerContent).find(".largePlayBtn");
            if ($(playButton).css("display") == 'block') {
                document.getElementById('removePlay').textContent = "Show play button";
                $(playButton).css("display", "none");
            }
            else {
                $(playButton).css("display", "block");
                document.getElementById('removePlay').textContent = "Hide play button";
            }
        });
        let hideControls = $("#hideControls");
        hideControls.click(function () {
            const hideControls = $("#kPlayer_ifp_ifp").contents()[0];
            const controls = window.kPlayer_ifp_ifp.document.querySelector('.controlBarContainer');
            if (controls.style.display == "none") {
                controls.style.display = "block";
                document.getElementById('hideControls').textContent = "Hide controls bar";
            }
            else {
                controls.style.display = "none";
                document.getElementById('hideControls').textContent = "Show controls bar";
            }

        });

        function goToVast() {
            let vastInspectUrl = 'https://developers.google.com/interactive-media-ads/docs/sdks/html5/vastinspector?tag=';
            let playerAdTag = document.kPlayer_ifp_ifp.kalturaIframePackageData.playerConfig.plugins.doubleClick.adTagUrl;
            window.open(vastInspectUrl + playerAdTag);
        }

        function getActiveSource() {
            const playerSource = document.kPlayer_ifp_ifp.kPlayer_ifp;
            const currentSource = playerSource.getSource();
            window.open(currentSource.src, '_blank');
        }

        function getActiveBitrate() {
            let playerFrame = document.kPlayer_ifp_ifp.kPlayer_ifp;
            alert(playerFrame.plugins.morePlugins.embedPlayer.currentBitrate);
        }

        function downloadJSON() {
            let jsonContent = document.getElementById('appendJSON');
            window.open('_blank').document.write(jsonContent.innerHTML);
        }
        let getSource = $("#getSource");
        getSource.click(function () {
            let playerSources = document.kPlayer_ifp_ifp.kPlayer_ifp.getSources();
            for (let i = 0; i < playerSources.length; i++) {
                parent.document.getElementById('appendStats').append(JSON.stringify(playerSources[i], null, 2));
            }
        });
        let getCaptions = $("#getCaptions");
        getCaptions.click(function () {
            let playerCaptions = document.kPlayer_ifp_ifp.kPlayer_ifp.mediaElement.getTextTracks();
            for (let i = 0; i < playerCaptions.length; i++) {
                parent.document.getElementById('appendStats').append(JSON.stringify(playerCaptions[i], null, 2));
            }
        });
        $(document).ready(function () {
            $('#topHeaderDiv, #appendStats, #kPlayer_ifp, #mainControlDiv').fadeIn(400);
        });
        //Preset ad selector for testing
        const adSlots = {
            inlinePreroll: {
                "slotType": "Inline preroll",
                "adTagUrl": "https://pubads.g.doubleclick.net/gampad/ads?sz=640x480&iu=/124319096/external/single_ad_samples&ciu_szs=300x250&impl=s&gdfp_req=1&env=vp&output=vast&unviewed_position_start=1&cust_params=deployment%3Ddevsite%26sample_ct%3Dlinear&correlator=",
            },
            skippablePreroll: {
                "slotType": "skippable preroll",
                "adTagUrl": "https://pubads.g.doubleclick.net/gampad/ads?sz=640x480&iu=/124319096/external/single_ad_samples&ciu_szs=300x250&impl=s&gdfp_req=1&env=vp&output=vast&unviewed_position_start=1&cust_params=deployment%3Ddevsite%26sample_ct%3Dskippablelinear&correlator=",
            },
            SingleRedirectError: {
                "slotType": "Single redirect error",
                "adTagUrl": "https://pubads.g.doubleclick.net/gampad/ads?sz=640x480&iu=/124319096/external/single_ad_samples&ciu_szs=300x250&impl=s&gdfp_req=1&env=vp&output=vast&unviewed_position_start=1&cust_params=deployment%3Ddevsite%26sample_ct%3Dredirecterror&nofb=1&correlator=",
            },
            None: {
                "slotType": "No ads",
                "adTagUrl": null,
            }
        };
        $(document).ready(function() {
            for (let prop in adSlots) {
                $("#adSlotSelector").append( "<option value= " + prop + ">" + adSlots[prop].slotType + "</option>" )
            }
        });
        function appendSlot(event){
            var prop = $(event.target).val();
            var $adTag = $("#adTagId");
            $("#adTagId").val(adSlots[prop].adTagUrl);
            $adTag.focus();
            $("#updateNotification").fadeIn(500);
        }
        function showReloadWarning() {
            $("#updateNotification").fadeIn(500);
        }
        //Open tinyUrl button
        let tiny = function(){
            window.open("http://tinyurl.com/api-create.php?url="+$(location).attr('href')+$(location).attr('search'), '_blank');
        };

    </script>

    <script>
        //Custom embed code loader script.
        function buildPath() {
            var path;
            if($('#embedPathSelector').prop('checked')){
                path = '/mwEmbed/mwEmbedLoader.php/p/' + $('#partnerId').val() + '/sp/' + $('#partnerId').val() +
                    '00/embedIframeJs/uiconf_id/' + $('#uiconfId').val() + '/partner_id/' + $('#partnerId').val() + "?&debug=true";
            } else {
                path = 'http://cdnapi.kaltura.com/p/' + $('#partnerId').val() + '/sp/' + $('#partnerId').val() +
                    '00/embedIframeJs/uiconf_id/' + $('#uiconfId').val() + '/partner_id/' + $('#partnerId').val() + "?&debug=true";
            }
            $.getScript(path, function (data, textStatus, jqxhr) {
                if (jqxhr.status === 200) {
                    reembedPlayer();
                } else {
                    alert("Script failed to load. Cannot render player :(");
                }
            });
            setTimeout($("#appendJSON").append(JSON.stringify(document.kPlayer_ifp_ifp.kalturaIframePackageData.playerConfig.plugins, null, 2)), 6000);
        }
        function reembedPlayer() {
            mw.setConfig("EmbedPlayer.ShowPlayerAlerts", true);
            mw.setConfig("debug", true);
            mw.setConfig("debugTarget", "analyticsLog");
            mw.setConfig("autoScrollDebugTarget", true);
            mw.setConfig('Kaltura.EnableEmbedUiConfJs', true);
                var partner = "_" + $('#partnerId').val();
                if ($('#partnerId').val().length <= 0) {
                    partner = "_1666321";
                }
                var uiconf = $('#uiconfId').val();
                if ($('#uiconfId').val().length <= 0) {
                    uiconf = "39652642";
                }
                var entry = $('#entryId').val();
                if ($('#entryId').val().length <= 0) {
                    entry = "0_kjb4gz27";
                }
                runtimeFields.text('');
                $("#errorBar").slideUp(300);
                cleanPreviousErrors();
            var str = $('.uivarsOverride').val();
            str = str.split("\n").join('');
            var myJson;
            try{
                if(str){
                    myJson = $.parseJSON(str);
                }
            } catch(error){
                alert('Please validate your JSON');
                return;
            }
            const newEmbed = {
                "targetId": "kPlayer_ifp",
                "wid": partner,
                "uiconf_id": uiconf,
                "flashvars": myJson,
                "cache_st": Date.now(),
                "entry_id": entry
            };
            document.kPlayer_ifp_ifp.kWidget.embed(newEmbed);
        }

    </script>
    <!--Main embed script-->
    <script>
        function embed() {
            runtimeFields.text('');
            $("#errorBar").slideUp(300);
            cleanPreviousErrors();
            $("#updateNotification").fadeOut(500);
            var adInput = $('#adTagId').val();
            if ($('#adTagId').val().length <= 0) {
                adInput = null
            }
            mw.setConfig("EmbedPlayer.ShowPlayerAlerts", true);
            mw.setConfig("debug", true);
            mw.setConfig("debugTarget", "analyticsLog");
            mw.setConfig("autoScrollDebugTarget", true);
            mw.setConfig('Kaltura.EnableEmbedUiConfJs', true);
            kWidget.embed({
                "targetId": "kPlayer_ifp",
                "wid": "_1955031",
                "uiconf_id": 37558971,
                "flashvars": {
                    "autoPlay": true,
                    "debugInfo.isVisible": false,
                    "DoubleClick": {
                        "plugin": true,
                        "adTagUrl": adInput,
                        "prerollUrlJs": "",
                        "leadWithFlash": true,
                        "trackCuePoints": false,
                        "debugMode": true, //Should enable debugMode for DoubleClick systems.
                        "adsManagerLoadedTimeout": 15000
                    },
                    "playlistAPI.plugin": false
                },
                "cache_st": Date.now(),
                "entry_id": "1_3ui8mc5o"
            })
        }
        $(function () {
            embed();
        });
    </script>
</div>

<div style="width:1125px; height: auto; margin: 0 auto;">
    <div style="clear: both;"></div>
    <button type="button" class="btn btn-primary btn-xs" style="float: right;" onclick=$("#analyticsLog").text('');>Clear log</button>
    <button type="button" class="btn btn-primary btn-xs" onclick=downloadJSON()>Download JSON</button>
</div>
<div style="clear: both;"></div>
<div id="footer">
    <p id="footer p">Created by Alex Milkis. Kaltura Customer Care 2017 &copy;</p></div>

</body>

</html>