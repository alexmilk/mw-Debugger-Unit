<!DOCTYPE html>
<html>

<head>
    <title>HLS.JS TEST - Disney</title>
    <!--Scripts sections-->
    <script src="http://player.kaltura.com/resources/jquery/jquery.min.js"></script>
    <script src="/mwEmbed/mwEmbedLoader.php/p/1750922/sp/175092200/embedIframeJs/uiconf_id/38602131/partner_id/1750922"></script>
    <link rel="stylesheet" href="mainStyles.css">
</head>

<body>

<div id="errorBar" style="padding-left: 10px">
    <p>An error has been logged on the player</p><button id="okError" style="float: left; margin-top: 10px; margin-left: 10px">OK</button>
</div>
<div class="navbar">
    <div style="float: left">
    <li>Home</li>
    <div class="dropdown">
    <button class="dropbtn">Functions</button>
        <div class="dropdown-content">
        <a onclick="embed(adInput)">Reload player</a>
        <a onclick="getActiveBitrate()">Get Current Bitrate</a>

        </div>
    </div>
    <div class="dropdown">
        <button class="dropbtn">Tools</button>
        <div class="dropdown-content">
            <a href="#">Get video aspect ratio</a>
            <a href="#" id="getActiveSource" onclick="getActiveSource()">Download active flavor</a>
            <a href="#" id="testOnVast" onclick="goToVast()">Test ad on Vast inspector</a>
            <a href="#">Standalone Dash Shaka player</a>
            <a href="#">Standalone HLS.JS player</a>
        </div>
    </div>    <div class="dropdown">
        <button class="dropbtn">Commands</button>
        <div class="dropdown-content">
            <a href="#" id="cleanMedia">Unload video asset</a>
            <a href="#" id="removeThumb">Remove Thumbnail</a>
            <a href="#" id="removePlay">Remove play button</a>
            <a href="#" id="hideControls">Hide controls bar</a>
        </div>
    </div>
    </div>
    <div style="float: right; height: 25px; width: 300px; padding-top: 6px; padding-right: 30px; text-align: right">
    <!--<input type="text" placeholder="Search anything" style="height: 20px; border-radius: 15px; border-width: 0; background-color: #FFFFFF; text-align: center; position: absolute;">-->
    <!--<input type="image" src="search-icon-white-hi.png" alt="Click to search" style="width: 20px; height: 20px;"/>-->
        <form id="searchField" onsubmit="return false;">
            <input style="height: 20px; border-radius: 15px; border-width: 0; background-color: #FFFFFF; text-align: center; margin-right: 5px" type="search" id="searchInput" placeholder="Search anything"/>
            <input type="image" src="search-icon-white-hi.png" style="width: 20px; height: 20px; position: absolute" onclick="searchSite();" alt="Click to search"/>
        </form>
    </div>
    </div>

<!--Player main div-->
<div id="topHeaderDiv">
    <div class="containerLeft">
        <h2 class="texts">HLS.JS Disney test</h2>
        <p id="uiconf" class="propertiesText"></p><br>
        <p id="entrydit" class="propertiesText"></p><br>
        <p id="loadTime" class="propertiesText"></p>
        <p id="tinyUrl" class="propertiesText">TinyURL: </p>
    </div>

<div class="containerRight">
    <!--QRCode Generator - Google Charts-->
    <p><img src="" alt="Grab me" id="generateMe" /></p>
    <script type="text/javascript">
        var ele = document.getElementById("generateMe");
        ele.src = "https://chart.googleapis.com/chart?cht=qr&chs=130x130&chl=" + document.location.href;
    </script>
    </div>
</div>
    <br>
    <!--The main section Player + Stats-->
    <div style="width:1125px; height: 335px; margin: auto;">
    <!--Main player DIV-->
    <div id="kPlayer_ifp" itemprop="video" itemscope></div>
    <!--Small analytics log DIV-->
    <pre id="appendStats"></pre></div>
    <!--Control panel & buttons DIV-->
    <div style="clear: both;"></div>
    <div id="mainControlDiv">
        <button type="button" onclick="changeEmbed()" class="btn" style="float: left;">Change Embed code</button>
        <button type="button" class="btn" onclick=doPlay()>Force Play</button>
        <button type="button" class="btn" onclick=doStop()>Force Stop</button>
        <button type="button" id="getSource" class="btn">get Sources</button>
        <button type="button" id="getCaptions" class="btn">get Captions</button>
        <button type="button" onclick="embed()" class="btn" style="float: left;">Reload player</button>


        <br><h7 style="font-family: Arial; font-size: smaller;">Entry ID changer:</h7>
        <form style="margin-top: 5px" id="formEntry" onsubmit="return false;">
            <input style="width: 380px;" type="text" id="adInput" placeholder="Input entry id"/>
            <input style="background-color: #b5b5b5; border-width: 0; border-radius: 8px; clear: none; margin-right: 10px; margin-bottom: 10px" type="submit" onclick="setEntry();"/>
        </form>
        <h7 style="font-family: Arial; font-size: smaller;">KS Changer:</h7>
        <form style="margin-top: 5px" id="formKs" onsubmit="return false;">
            <input style="width: 380px;" type="text" id="ksInput" placeholder="Input valid KS"/>
            <input style="background-color: #b5b5b5; border-width: 0; border-radius: 8px; clear: none; margin-right: 10px; margin-bottom: 5px" type="submit" onclick="setKS();"/>
        </form>
        <p style="font-family: Arial; font-size: smaller; margin-bottom: 5px;">DoubleClick ad tag:</p>
        <input style="width: 380px;" type="text" id="adTagId" /><span>
        <button type="button" style="background-color: #b5b5b5; border-width: 0; border-radius: 8px; clear: none; margin-left: 5px; margin-bottom: 10px;" onclick=callAd()>Call ad response
    </button></span>
        <select id="adSlotSelector" name="Select an ad tag" size="1">
        </select>
        <div id="customEmbedParams">
            <form onsubmit="return false;">
                <input id="partnerId" style="width: 100px; margin-bottom: 10px" type="text" placeholder="Partner Id"/><br>
                <input id="uiconfId" style="width: 100px; margin-bottom: 10px" type="text" placeholder="Player Id"/><br>
                <input id="entryId" style="width: 100px; margin-bottom: 10px" type="text" placeholder="Entry Id"/>
                <input id="submitEmbed" style="width: 100px; margin-bottom: 10px" type="submit"/>
            </form>
            <textarea id="uivarsOverride" style="width: 250px; height: 200px; max-width: 290px; max-height: 205px; color: black;" placeholder="Add valid flashvars:"></textarea>
        </div>
    </div><br>
    <!--JSON Config DIV-->
<div style="width:1125px; height: 410px; margin: 0 auto;">
    <p style="font-size: small; font-family: Arial; margin: 0;">Player's JSON config:</p>
    <pre id="appendJSON"></pre>
    <div id="analyticsLog" style="float: right; box-sizing: border-box;">
</div>

    <br>

    <script>
        const playerFrame = document.kPlayer_ifp_ifp;
        //kBinds and other functions
        kWidget.addReadyCallback(function (playerId) {
            var kdp = document.getElementById(playerId);
            kdp.kBind('playerReady', function () {
                $("#analyticsLog").append(kdp.evaluate("Player Version: " + "{playerVersion}<br>\n")).addClass("greenText");
                $("#analyticsLog").append(kdp.evaluate("Entry Id: " + "{mediaProxy.entry.id}\n<br>")).addClass("greenText");
                kdp.kBind('playerReady', function () {
                    $("#analyticsLog").append("Ready to play.<br>").addClass("greenText")
                });
                $("#entrydit").replaceWith(kdp.evaluate("<b>Entry id: </b>" + "<b>{mediaProxy.entry.id}\n</b>"));
                $("#uiconf").replaceWith(kdp.evaluate("<b>Player id: </b>" + "<b>{configProxy.kw.uiConfId}\n</b>"));
                $.loadedTime = window.performance.timing.domContentLoadedEventEnd - window.performance.timing.navigationStart;
                $("#loadTime").append("Page loaded in " + $.loadedTime + " milliseconds");
            });

            kdp.kBind('mediaReady', function () {
                $("#analyticsLog").append("Media Ready\n<br>").addClass('greenText');
            });
            kdp.kBind('adEnd', function () {
                $("#analyticsLog").append("Ad Ended\n<br>").addClass('greenText');
            });
            kdp.kBind('postSequenceStart', function () {
                $("#analyticsLog").append("Post Sequence Started\n<br>").addClass('greenText');
            });
            kdp.kBind('firstPlay', function () {
                $("#analyticsLog").append("First Play\n<br>").addClass('greenText');
            });
            kdp.kBind('doPause', function () {
                $("#analyticsLog").append("Player Paused\n<br>").addClass("greenText");
            });
            kdp.kBind('doPlay', function () {
                $("#analyticsLog").append("Player Playing\n<br>").addClass("greenText");
            });
            kdp.kBind('playerError', function (errorEvent) {
                $("#errorBar").slideDown(300);
                $("#errorBar p").append(" - " + errorEvent.message);
            });
            kdp.kBind('mediaErrorError', function (errorEvent) {
                $("#errorBar").slideDown(300);
                $("#errorBar p").append(" - " + errorEvent.message);
            });
            //OK button handler
            $('#okError').click(function () {
                $('#errorBar').slideUp(300);
            });
            kdp.kBind('bumperStarted', function () {
                $("#analyticsLog").append("Bumper Started\n<br>").addClass("greenText");
            });
            kdp.kBind('postSequenceStart', function () {
                $("#analyticsLog").append("Playing Post Sequence.\n<br>").addClass("greenText");
            })
        });

        //The mainBrain
        function setEntry() {
            kWidget.addReadyCallback(function (playerId) {
                var kdp = document.getElementById(playerId);
                var input = document.getElementById("adInput").value;
                kdp.sendNotification("changeMedia", {
                    "entryId": input
                });
            })
        }
        $("#cleanMedia").click(function () {
            kWidget.addReadyCallback(function (playerId) {
                var kdp = document.getElementById(playerId);
                kdp.sendNotification("cleanMedia");
            })
        })

        function setKS() {
            kWidget.addReadyCallback(function (playerId) {
                var kdp = document.getElementById(playerId);
                var input = document.getElementById("ksInput").value;
                kdp.setKDPAttribute('servicesProxy.kalturaClient', 'ks', input);
            })
        }

        function doPlay() {
            kWidget.addReadyCallback(function (playerId) {
                var kdp = document.getElementById(playerId);
                kdp.sendNotification("doPlay");
            })
        }

        function doStop() {
            kWidget.addReadyCallback(function (playerId) {
                var kdp = document.getElementById(playerId);
                kdp.sendNotification("doStop");
            })
        }

        function callAd() {
            kWidget.addReadyCallback(function (playerId) {
                $.kPlayer = document.kPlayer_ifp_ifp;
                window.open($.kPlayer.kalturaIframePackageData.playerConfig.plugins.doubleClick.adTagUrl);
                return false;
            })
        }

        function changeEmbed() {
            if ($('#customEmbedParams').css("display") == "none") {
                $("#customEmbedParams").slideDown(500);
            }
            else {
                $("#customEmbedParams").slideUp(500);
            }
        }
        $(document).ready(function () {
            var msg = $.ajax({
                type: "GET",
                url: "https://tinyurl.com/api-create.php?url=" + document.location.href,
                async: false
            }).responseText;
            $("#tinyUrl").append(msg);
            return false;
        });
        kWidget.addReadyCallback(function (playerId) {
            var kdp = document.getElementById(playerId);
            kdp.kBind('playerReady', function () {
                $.kPlayer = document.kPlayer_ifp_ifp;
                $("#appendJSON").append(JSON.stringify(document.kPlayer_ifp_ifp.kalturaIframePackageData.playerConfig.plugins, null, 2));
                $(".mw-debug-info").append(document.kPlayer_ifp_ifp.kalturaIframePackageData.playerConfig.plugins.debugInfo);
                return false;
            })
        });
        $(document).ready(function () {
            kWidget.addReadyCallback(function (playerId) {
                $.kPlayer = document.kPlayer_ifp_ifp;
                const input = $("#adTagId");
                input.val(input.val() + $.kPlayer.kalturaIframePackageData.playerConfig.plugins.doubleClick.adTagUrl);
                return false;
            })
        });
        // Top menu buttons and logic
        $("#removeThumb").click(function () {
            const playerContent = $("#kPlayer_ifp_ifp").contents()[0];
            const playerThumb = $(playerContent).find("#kPlayer_ifp");
            if ($(playerThumb).css("visibility") == 'visible') {
                document.getElementById('removeThumb').textContent = "Show thumbnail";
                $(playerThumb).css("visibility", "hidden");
            }
            else {
                $(playerThumb).css("visibility", "visible");
                document.getElementById('removeThumb').textContent = "Hide thumbnail";
            }
        });
        $("#removePlay").click(function () {
            const playerContent = $("#kPlayer_ifp_ifp").contents()[0];
            const playButton = $(playerContent).find(".largePlayBtn");
            if ($(playButton).css("display") == 'block') {
                document.getElementById('removePlay').textContent = "Show play button";
                $(playButton).css("display", "none");
            }
            else {
                $(playButton).css("display", "block");
                document.getElementById('removePlay').textContent = "Hide play button";
            }
        });
        $("#hideControls").click(function () {
            const hideControls = $("#kPlayer_ifp_ifp").contents()[0];
            const controls = window.kPlayer_ifp_ifp.document.querySelector('.controlBarContainer');
            if (controls.style.display == "none") {
                controls.style.display = "block";
                document.getElementById('hideControls').textContent = "Hide controls bar";
            }
            else {
                controls.style.display = "none";
                document.getElementById('hideControls').textContent = "Show controls bar";
            }

        });

        function goToVast() {
            window.open("https://developers.google.com/interactive-media-ads/docs/sdks/html5/vastinspector?tag=" + document.kPlayer_ifp_ifp.kalturaIframePackageData.playerConfig.plugins.doubleClick.adTagUrl);
        }

        function getActiveSource() {
            const playerSource = document.kPlayer_ifp_ifp.kPlayer_ifp;
            const currentSource = playerSource.getSource();
            window.location.assign(currentSource.src);
        }

        function getActiveBitrate() {
            let k = document.kPlayer_ifp_ifp;
            let k2 = k.document.getElementsByClassName('persistentNativePlayer nativeEmbedPlayerPid');
            let sumk = k2.pid_kPlayer_ifp.webkitVideoDecodedByteCount / 1000;
            alert(sumk);
        }

        function downloadJSON() {
            let jsonContent = document.getElementById('appendJSON');
            window.open('_blank').document.write(jsonContent.innerHTML);
        }
        $("#getSource").click(function () {
            var playerSources = document.kPlayer_ifp_ifp.kPlayer_ifp.getSources();
            for (var i = 0; i < playerSources.length; i++) {
                parent.document.getElementById('appendStats').append(JSON.stringify(playerSources[i], null, 2));
            }
        });
        $("#getCaptions").click(function () {
            var playerCaptions = document.kPlayer_ifp_ifp.kPlayer_ifp.mediaElement.getTextTracks();
            for (var i = 0; i < playerCaptions.length; i++) {
                parent.document.getElementById('appendStats').append(JSON.stringify(playerCaptions[i], null, 2));
            }
        });
        $('button[type=button], input[type=submit]').hover(function () {
            $(this).fadeOut(50);
            $(this).fadeIn(50);
        });
        $(document).ready(function () {
            $('#topHeaderDiv, #appendStats, #kPlayer_ifp, #mainControlDiv').fadeIn(400);
        });
        $(document).ready(function() {
            const adSlots = {
                inlinePreroll: {
                    "slotType": "Inline preroll",
                    "adTagUrl": "https://pubads.g.doubleclick.net/gampad/ads?sz=640x480&iu=/124319096/external/single_ad_samples&ciu_szs=300x250&impl=s&gdfp_req=1&env=vp&output=vast&unviewed_position_start=1&cust_params=deployment%3Ddevsite%26sample_ct%3Dlinear&correlator=",
                },
                skippablePreroll: {
                    "slotType": "skippable preroll",
                    "adTagUrl": "https://pubads.g.doubleclick.net/gampad/ads?sz=640x480&iu=/124319096/external/single_ad_samples&ciu_szs=300x250&impl=s&gdfp_req=1&env=vp&output=vast&unviewed_position_start=1&cust_params=deployment%3Ddevsite%26sample_ct%3Dlinear&correlator=",
                }
            };
            for (let prop in adSlots) {
                var str = "lalalala";
                $("#adSlotSelector").append( "<option value='new'>" + adSlots[prop].slotType + "</option>" )
    //adSlots[prop].slotType
            }
        });
    </script>
    <script>
        //Empty embed object for custom embeds
        $('#submitEmbed').click( function() {
            var flashvars = $('#uivarsOverride').val();
            const newEmbed = {
                "targetId": "kPlayer_ifp",
                "wid": "_" + $('#partnerId').val(),
                "uiconf_id": $('#uiconfId').val(),
                "flashvars": {},
                "cache_st": 1466954509,
                "entry_id": $('#entryId').val()
            };
            document.kPlayer_ifp_ifp.kWidget.embed(newEmbed);
        })
    </script>
    <!--Main embed script-->
    <script>
        const emptyFlashvars = {};
        const partnerId = 0;
        const uiconfId = 0;
        const entryId = 0;
        const adInput = document.getElementById('adTagId');
        function embed(adInput) {
            mw.setConfig("EmbedPlayer.ShowPlayerAlerts", true);
            mw.setConfig("debug", true);
            mw.setConfig("debugTarget", "analyticsLog");
            mw.setConfig("autoScrollDebugTarget", true);
            kWidget.embed({
                "targetId": "kPlayer_ifp",
                "wid": "_1750922",
                "uiconf_id": 38602131,
                "flashvars": {
                    "streamerType": "auto",
                    "EmbedPlayer.WebKitPlaysInline": false,
                    "autoPlay": false,
                    "doubleClick.plugin": true,
                    "doubleClick.adTagUrl": adInput,
                    "doubleClick.leadWithFlash": true,
                    "doubleClick.debugMode": true,
                    "doubleClick.adsManagerLoadedTimeout": 20000,
                    "skipBtn": {
                        "plugin": true,
                        "label": "Skip Ad",
                        "skipOffset": 5
                    },
                    "vast": {
                        "prerollUrl": null,
                        "plugin": false
                    },
                    "debugInfo.isVisible": false,
                    "disableHLSOnJs": false
                },
                "cache_st": 1466954509,
                "entry_id": "1_q21adrz7"
            })
        }
        $(function () {
            embed();
        });
    </script>
</div>

<div style="width:1125px; height: 20px; margin: 0 auto;">
    <div style="clear: both;"></div>
    <button type="button" style="border-width: 0; border-radius: 8px; margin-top: 2px; margin-bottom: 5px; float: right;"
            onclick=$("#analyticsLog").empty();>Clear log</button>
    <button type="button" class="btn" onclick=downloadJSON()>Download JSON</button>
</div>
<div style="clear: both;"></div>
<div style="width: 100%; margin-bottom: 0; bottom: 0; border-top-width: 2px; border-top-color: greenyellow; border-top-style: solid; position: static; background-color: #333; height: 25px; text-align: center; padding-bottom: 7px;">
    <p style="font-size: 10px; font-family: Arial; color: white;">Designed by Alex Milkis. &copy;</p></div>

</body>

</html>